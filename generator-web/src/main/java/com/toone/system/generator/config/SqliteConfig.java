package com.toone.system.generator.config;import com.toone.system.generator.util.SqliteBuilder;import com.toone.system.generator.util.SqliteUtils;import lombok.extern.slf4j.Slf4j;import org.mybatis.spring.annotation.MapperScan;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import javax.sql.DataSource;import java.sql.SQLException;@MapperScan(sqlSessionFactoryRef = "sqlSessionFactory")@Configuration@Slf4jpublic class SqliteConfig {    //数据源url    @Value("${spring.datasource.url}")    private String dataSourceUrl;    /**     * 配置sqlite数据源     *     * @return     */    @Bean(name = "sqliteDataSource")    public DataSource sqliteDataSource() {        //尝试创建sqlite文件-不存在时创建        SqliteUtils.initSqliteFile(SqliteUtils.getFilePath(dataSourceUrl));        //创建数据源        var dataSource = SqliteBuilder.create().url(dataSourceUrl).build();        try {            //尝试初始化数据库-表不存在时创建            SqliteUtils.initProDb(dataSource.getConnection());        } catch (SQLException e) {            log.error("尝试初始化数据库-表不存在时创建失败",e);        }        return dataSource;    }}